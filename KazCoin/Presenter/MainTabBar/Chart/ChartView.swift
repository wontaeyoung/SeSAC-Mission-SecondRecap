//
//  ChartView.swift
//  KazCoin
//
//  Created by 원태영 on 2/29/24.
//

import UIKit
import KazUtility
import DGCharts
import CoinDesignSystem

final class ChartView: BaseView {
  
  // MARK: - UI
  private let dummy = [
    51613.43253578913,
    51516.75932498234,
    51149.05588447203,
    51393.84969370881,
    51576.70292130172,
    51454.59679240083,
    51711.14580544951,
    51651.87986630683,
    51484.038829987636,
    51965.0332258993,
    51578.57739458951,
    51462.3712941115,
    51319.500125702674,
    51445.07757429647,
    51290.46384473216,
    51095.29306783685,
    51067.967072300395,
    51201.271638117025,
    51124.97620014934,
    51289.85201499646,
    50880.92367526176,
    50908.81488660626,
    50949.359440781955,
    51166.195179806724,
    51210.2940639519,
    50983.584307534344,
    51051.37119011336,
    51102.27794973614,
    50910.394626552355,
    51023.57720713857,
    51135.962066839966,
    51131.27428819613,
    51080.37683198738,
    51091.530003433276,
    50985.782654840594,
    50773.475118871436,
    50841.081094770896,
    50863.48685286495,
    50607.52920064971,
    50788.125508990335,
    50848.88547504514,
    50950.327041790515,
    51054.130061598386,
    50962.224264356795,
    51050.048117445396,
    50982.60912739779,
    51065.08904770135,
    51068.9235454728,
    51127.62804168001,
    51073.36046728882,
    51131.48175102287,
    51094.447775398425,
    51112.86772237167,
    51208.34658039908,
    51697.48554467913,
    51484.681536061114,
    51599.12248105399,
    51513.39102333645,
    51558.64778532889,
    51573.73667905135,
    51553.096712831146,
    51485.262018375855,
    51614.216980192345,
    51545.32115884375,
    51621.629465192906,
    51627.64128004587,
    51699.201967815585,
    51735.61018071985,
    51726.82888554329,
    51619.54399665533,
    51631.8944123664,
    51576.56470709675,
    51654.025665677225,
    51682.02969592259,
    51631.39988867448,
    51731.35612456198,
    51509.00951660319,
    51405.50649460264,
    51556.434366413734,
    51538.633942542714,
    51680.84842899583,
    51730.0957098725,
    51774.377396554664,
    51701.55732383541,
    51725.35393162457,
    51674.530312562376,
    51458.999296344286,
    51449.58877439659,
    51556.22697206768,
    51549.89709261979,
    51572.065623970644,
    51498.098290461494,
    51300.41485157674,
    51278.663078190846,
    50926.780715974346,
    51180.839719248645,
    51104.85484650301,
    51177.737528338555,
    51231.644578738815,
    51690.697700635785,
    52847.175807956504,
    53394.43288905663,
    53443.62062782177,
    53633.072547559466,
    54455.91125142581,
    54685.05166599562,
    54628.95571513321,
    54675.40695784579,
    54478.191083122954,
    54580.139740714294,
    55672.854203004914,
    56318.200914074,
    55580.07369933234,
    55801.08659956298,
    56116.347347991315,
    56386.72475545337,
    56104.12682333932,
    56275.61320474057,
    56643.12554071901,
    56581.53705935442,
    56541.39108692869,
    56996.51844918365,
    57106.04893315183,
    56900.31296833004,
    56765.128743317684,
    57051.62669658581,
    56841.94128068301,
    57128.702536398945,
    57442.86321085786,
    56737.94085264713,
    56650.03245400538,
    56918.454940304226,
    57003.52673730811,
    56994.916552693576,
    56857.608882839384,
    56951.85869803529,
    56958.15831123478,
    57227.46105933989,
    57116.64046654168,
    57135.482349711136,
    58123.24153531823,
    59508.88968993828,
    59325.37345452618,
    59266.18106118569,
    58983.94738732378,
    59397.89259241082,
    60465.38088698786,
    61142.98509518815,
    60925.10725370209,
    62496.70796054818,
    61236.56819459582,
    61203.7868191401,
    61006.464690927794,
    60426.396959183345,
    60504.09754571494,
    61348.393440923515,
    62518.58004146406,
    61353.4196653466,
    61354.959518742406,
    61753.20998644972,
    61594.439045000516,
    62494.350476384025,
    62327.58781450792,
    62938.70597072361,
    62713.90519421873,
    62791.57565972651,
    62794.27161842451,
    62701.975438427515
    ]
  private let chart = LineChartView().configured {
    $0.legend.enabled = false
    $0.leftAxis.enabled = false
    $0.rightAxis.enabled = false
    $0.xAxis.enabled = false
  }
  
  private let gradientColor: [CGColor] = [
    KazCoinAsset.Color.background.cgColor,
    KazCoinAsset.Color.brand.cgColor
  ]
  
  private lazy var gradient: CGGradient = .init(colorsSpace: nil, colors: gradientColor as CFArray, locations: nil)!
  
  // MARK: - Life Cycle
  override func setHierarchy() {
    addSubviews(chart)
  }
  
  override func setConstraint() {
    chart.snp.makeConstraints { make in
      make.center.equalTo(self)
      make.width.equalToSuperview()
      make.height.equalTo(self).multipliedBy(0.5)
    }
  }
  
  // MARK: - Method
  func updateUI(from list: [Double]) {
    let entry: [ChartDataEntry] = list.enumerated().map {
      ChartDataEntry(x: Double($0.offset), y: $0.element)
    }
    
    let set = LineChartDataSet(entry).configured {
      $0.fill = LinearGradientFill(gradient: gradient, angle: 90)
      $0.fillAlpha = 0.7
      $0.drawFilledEnabled = true
      $0.drawCircleHoleEnabled = false
      $0.drawCirclesEnabled = false
      $0.setColor(KazCoinAsset.Color.brand)
      $0.mode = .cubicBezier
      $0.lineWidth = 2
      $0.drawHorizontalHighlightIndicatorEnabled = false
      $0.drawVerticalHighlightIndicatorEnabled = false
    }
    
    chart.data = LineChartData(dataSet: set)
  }
}

@available(iOS 17, *)
#Preview {
 ChartView()

}
